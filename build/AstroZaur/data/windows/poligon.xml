<?xml version="1.0"?>
<astrozaur>
    <title>Natal</title>
    <chart type="natal">
	<info>Natal</info>
	<id>natal</id>
	<date>Now</date>
	<time>Now</time>
	<rotate_sec>60</rotate_sec>

	<lua>
	    <load>data/lua/test.lua</load>

    	    <chunk when="INIT">
	        local self = ...
		
		self.comment = "Natal chart"
		
		print("--- chart", self.info)
		for i,n in pairs(self) do
		    print("\t", i, n)
		end
	    </chunk>
	    
	    <chunk when="INFO">natal(...)</chunk>
	</lua>
    </chart>

    <lua>
	<chunk when="INIT">
	    local self = ...
	    local win = self.window
	    
	    local tiled = win.tiledgroup(self.draw.x(), self.draw.y(), self.draw.w(), self.draw.h())

	    -- Remove draw area
	    
	    tiled.add(self.draw)
	    self.draw.y(0)
	    self.draw.w(self.draw.w() - 40)
	    self.draw.h(self.draw.h() - 40)
	    self.draw.backcolor("#5555FF")
	    
	    -- Create status line
	    
	    local status = tiled.box(0, self.draw.b(), self.draw.w(), 20)
	    status.label("Status...\nmulti-line!")
	    status.labelsize(16)
	    status.backcolor("#0000FF")
	    status.labelcolor("#FFFF00")
	    
	    local progress = tiled.progress(0, status.b(), status.w(), 20, "")
	    progress.range(0,20)
	    progress.step(10)

	    -- Create right draw area

	    local right = tiled.drawbox(self.draw.r(), self.draw.y(), 40, tiled.h()/2)
	    
	    function right:draw()
		self.color("#0000FF")
		self.addarc(2,2, self.w()-2,self.h()-2, 0,360)
		self.strokepath()
	    end

	    local html = tiled.html(right.x(), right.b(), right.w(), tiled.h()/2)
	    html.value("normal text")

	    win.resizable(tiled)

	    self.status = status
	    self.tiled = tiled
	    self.progress = progress

	    self.INFO["draw"] = function(self)
		if self.active then
		    local chart = self.active
		    local color = { "#888888", "#444444","#222222", "#000000", "#222222", "#666666",
				    "#999999", "#AAAAAA","#CCCCCC", "#FFFFFF", "#BBBBBB", "#999999"}
		    
		    local h = astro.between(chart.point.Sun.lon,
			chart.point.I.lon, chart.point.II.lon, chart.point.III.lon, chart.point.IV.lon,
			chart.point.V.lon, chart.point.VI.lon, chart.point.VII.lon, chart.point.VIII.lon,
			chart.point.IX.lon, chart.point.X.lon, chart.point.XI.lon, chart.point.XII.lon,
			chart.point.I.lon)
			
		    self.draw.backcolor(color[h])
		end

		if self.status and self.active then
	    	    self.status.label(self.active.info)
		    self.status.redraw()
		end
	    end

	</chunk>
    </lua>

    <active_chart name="id:natal"/>
    <aspect_chart name="id:natal"/>
    <start_chart name="id:natal" point="Asc"/>
</astrozaur>
